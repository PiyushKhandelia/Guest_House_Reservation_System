<!DOCTYPE html>
<html>
    <head>
        <link rel="icon" type="image/x-icon" href="https://piyushkhandelia.github.io/Guest_House_Reservation_System/Images/bit_logo.png">
        <link rel="stylesheet" href="https://piyushkhandelia.github.io/Guest_House_Reservation_System/css/homepage.css">
        <link rel="stylesheet" href="https://piyushkhandelia.github.io/Guest_House_Reservation_System/css/booking.css">
        <script src="https://kit.fontawesome.com/a81980af38.js" crossorigin="anonymous"></script>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Booking</title>
    </head>
    <body>
        <!-- Rules section -->
        <div id="rules_section" class="rules_section" style="display: block;">
            <p>Please read the rules before proceeding:</p>
            <ul>
                <li>Rule 1: A maximum of 2 guests is allowed in 1 room.</li>
                <li>Rule 2: You can book a room for not more than 3 days</li>
                <li>Rule 3: You have to either Check-In or inform us for delay within 3 hours of Checking-In Time or your bokking will be discarded. </li>
                <!-- Add more rules as needed -->
            </ul>
            <p>Guest House Policies:- <a href="https://www.bitmesra.ac.in/UploadedDocuments/pratyush_869/files/Guest_House/guest_house_policy.pdf">Click here</a></p>
            <button onclick="showBookingForm()" class="alert">Continue</button>
        </div>

        <div class="header_div">
            <div class="left_div"></div>
            <div class="right_div">
                <div class="nav">
                    <a href="https://piyushkhandelia.github.io/Guest_House_Reservation_System/booking.html"><button>Book Now</button></a>
                    <a href="https://piyushkhandelia.github.io/Guest_House_Reservation_System/Pages/my_bookings.html"><button>My Bookings</button></a>
                    <a href="https://piyushkhandelia.github.io/Guest_House_Reservation_System/Pages/profile.html"><button>Profile</button></a>
                    <a href="https://piyushkhandelia.github.io/Guest_House_Reservation_System/Pages/login_signup.html"><button>Logout</button></a>
                </div>
            </div>
        </div>

        <!-- Booking form section -->
        <div id="booking_form" class="booking_form" style="display: none;">
            <p class="heading">Book Now</p>
            <form id="bookingForm" class="bookingForm" onsubmit="book_now(event)">
                <!-- Existing form fields -->
                <label for="name">Name:<sup>*</sup></label><br>
                <input type="text" id="name" name="name" ><br>

                <label for="email">Email:<sup>*</sup></label><br>
                <input type="email" id="email" name="email" ><br>

                <label for="email">Institute Email:</label><br>
                <input type="email" id="inst_email" name="inst_email"><br>

                <label for="phone">Phone:<sup>*</sup></label><br>
                <input type="tel" id="phone" name="phone" placeholder="12345 67890" ><br>

                <label for="phone">Alternate No.:</label><br>
                <input type="tel" id="alt_phone" name="alt_phone" placeholder="12345 67890"><br>

                <label for="category">Category:<sup>*</sup></label><br>
                <select id="category" name="category" >
                    <option value="">You are:</option>
                    <option value="Aadhar Card">Student</option>
                    <option value="Driving License">Teacher</option>
                    <option value="Others">Others</option>
                    <!-- Add more options as needed -->
                </select><br>

                <!-- Add new columns for additional form fields -->
                <label for="college_id">College Unique ID No.:</label><br>
                <input type="text" id="college_id" name="college_id"><br>

                <label for="id_proof">ID Proof:<sup>*</sup></label><br>
                <select id="id_proof" name="id_proof" >
                    <option value="">Select ID Proof</option>
                    <option value="Aadhar Card">Aadhar Card</option>
                    <option value="Driving License">Driving License</option>
                    <!-- Add more options as needed -->
                </select><br>
                    
                <label for="id_proof_number">ID Proof No.:<sup>*</sup></label><br>
                <input type="text" id="id_proof_number" name="id_proof_number" ><br>
                    
                <label for="gender">Gender:<sup>*</sup></label><br>
                <select id="gender" name="gender" >
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Rather not to Say">Rather not to Say</option>
                    <!-- Add more options as needed -->
                </select><br>
                    
                <label for="permanent_address_location">Permanent Address Location:<sup>*</sup></label><br>
                <input type="text" id="permanent_address_location" name="permanent_address_location" ><br>
                    
                <label for="permanent_address_pin">PIN Code:<sup>*</sup></label><br>
                <input type="text" id="permanent_address_pin" name="permanent_address_pin" ><br>
                    
                <label for="permanent_address_state">State:<sup>*</sup></label><br>
                <input type="text" id="permanent_address_state" name="permanent_address_state" ><br>
                    
                <label for="permanent_address_area">Area:<sup>*</sup></label><br>
                <input type="text" id="permanent_address_area" name="permanent_address_area" ><br>

                <label for="text">Select<sup>*</sup></label>
                <select id="guest_house" name="guest_house" >
                    <option value="">Guest House</option>
                    <option value="igh">IGH</option>
                    <option value="ogh">OGH</option>
                </select>

                <label for="room_type">Room Type:<sup>*</sup></label>
                <select id="room_type" name="room_type" >
                    <option value="">Select Room Type</option>
                    <option value="single">Single</option>
                    <option value="double">Double</option>
                    <option value="suite">Suite</option>
                </select>
                    
                <label for="date">Date (From):<sup>*</sup></label><br>
                <input type="date" id="dateF" name="date" ><br>
                        
                <label for="date">Date (To):<sup>*</sup></label><br>
                <input type="date" id="dateT" name="date" ><br>

                <label for="duration">Duration (Days):</label><br>
                <input type="text" id="duration" name="duration" readonly><br>

                <label for="room_type">Captcha:<sup>*</sup></label><br>
                <!--Inupt Visible Captch from Js-->
                <input type="text" id="textInput" placeholder="Enter Captcha">
                <!--Load Captch-->
                <input class="capt" id="capt" readonly="readonly">    
                <!--Refresh-->
                <span id="refresh"><i class="fa-solid fa-rotate" onclick="cap()"></i></span>

                <button onclick="book_now()">Book Now</button>
            </form>
        </div>
        <script src="https://piyushkhandelia.github.io/Guest_House_Reservation_System/js/booking.js"></script>
        <script src="https://piyushkhandelia.github.io/Guest_House_Reservation_System/js/refresh_captcha.js"></script>
        <!--<script src="https://piyushkhandelia.github.io/Guest_House_Reservation_System/js/bookToFirebase.js"></script>-->
        <script>
            import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
            import { database } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-database.js"

            // Your web app's Firebase configuration
            const firebaseConfig = {
                apiKey: "AIzaSyBRI8aRPiHrQL9fWgNH9JgWpBtD8GTPuv8",
                authDomain: "guesthousebookingsystem-675c6.firebaseapp.com",
                databaseURL: "https://guesthousebookingsystem-675c6-default-rtdb.firebaseio.com",
                projectId: "guesthousebookingsystem-675c6",
                storageBucket: "guesthousebookingsystem-675c6.appspot.com",
                messagingSenderId: "979837493640",
                appId: "1:979837493640:web:64745b6eefd825d4c31a3d"
            };

            firebase.initializeApp(firebaseConfig);
            const database = firebase.database()
            const ref = database.ref("bookings")

            function book_now(event) {
                event.preventDefault();
                var name = document.getElementById("name").value.trim();
                var email = document.getElementById("email").value.trim();
                var inst_email = document.getElementById("inst_email").value.trim();
                var phone = document.getElementById("phone").value.trim();
                var alt_phone = document.getElementById("alt_phone").value.trim();
                var category = document.getElementById("category").value.trim();
                var idProof = document.getElementById("id_proof").value.trim();
                var idProofNumber = document.getElementById("id_proof_number").value.trim();
                var gender = document.getElementById("gender").value.trim();
                var permanentAddressLocation = document.getElementById("permanent_address_location").value.trim();
                var permanentAddressPin = document.getElementById("permanent_address_pin").value.trim();
                var permanentAddressState = document.getElementById("permanent_address_state").value.trim();
                var permanentAddressArea = document.getElementById("permanent_address_area").value.trim();
                var enteredCaptcha = document.getElementById("textInput").value.trim();
                var displayedCaptcha = document.getElementById("capt").value.trim();
                var guestHouse = this.value;
                var roomType = document.getElementById('room_type').value;
                var bookedRoom = " ";
                var roomNo = bookedRoom;
                var dateFrom = new Date(document.getElementById('dateF').value);
                var dateTo = new Date(document.getElementById('dateT').value);
                var duration = document.getElementById('duration').value;
                var dateTime = " ";
                
                // Initialize the arrays
                var singleRoomAvailable_OGH = [101, 102, 103, 104, 201, 202, 203, 204];
                var suitesAvailable_OGH = [1001, 1002, 2001, 2002];
                var singleRoomAvailable_IGH = [101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 201, 202, 203, 204, 205, 206, 207, 214, 215, 216];
                var mesaninAvailable_IGH = [208, 209, 210, 211, 212, 213];
                var suitesAvailable_IGH = [1001, 1002, 2001, 2002];
                var singleRoomBooked_OGH = [];
                var suitesBooked_OGH = [];
                var singleRoomBooked_IGH = [];
                var mesaninBooked_IGH = [];
                var suitesBooked_IGH = [];
                
                //Iniyalize the variables
                var currentDate = new Date();

                // Get the current date and time components
                var year = currentDate.getFullYear();
                var month = ('0' + (currentDate.getMonth() + 1)).slice(-2); // Months are zero based
                var day = ('0' + currentDate.getDate()).slice(-2);
                var hours = ('0' + currentDate.getHours()).slice(-2);
                var minutes = ('0' + currentDate.getMinutes()).slice(-2);
                var seconds = ('0' + currentDate.getSeconds()).slice(-2);

                // Create a formatted string for date and time
                dateTime = year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds;

                if (enteredCaptcha === displayedCaptcha) {
                    // Check guest house and room type and book accordingly
                    if (guestHouse === 'ogh' && roomType === 'single') {
                        if (singleRoomAvailable_OGH.length > 0) {
                            // Shift one element from singleRoomAvailable to singleRoomBooked
                            bookedRoom = singleRoomAvailable_OGH.shift();
                            singleRoomBooked_OGH.push(bookedRoom);
                        } else {
                            alert("Room is unavailable");
                            return false; // Prevent form submission
                        }   
                    } else if (guestHouse === 'ogh' && roomType === 'suite') {
                        if (suitesAvailable_OGH.length > 0) {
                            // Shift one element from singleRoomAvailable to singleRoomBooked
                            bookedRoom = suitesAvailable_OGH.shift();
                            suitesBooked_OGH.push(bookedRoom);
                        } else {
                            alert("Room is unavailable");
                            return false; // Prevent form submission
                        }
                    } else if (guestHouse === 'igh' && roomType === 'single') {
                        if (singleRoomAvailable_IGH.length > 0) {
                            // Shift one element from singleRoomAvailable to singleRoomBooked
                            bookedRoom = singleRoomAvailable_IGH.shift();
                            singleRoomBooked_IGH.push(bookedRoom);
                        } else {
                            alert("Room is unavailable");
                            return false; // Prevent form submission
                        }
                    } else if (guestHouse === 'igh' && roomType === 'mesanin') {
                        if (mesaninAvailable_IGH.length > 0) {
                            // Shift one element from singleRoomAvailable to singleRoomBooked
                            bookedRoom = mesaninAvailable_IGH.shift();
                            mesaninBooked_IGH.push(bookedRoom);
                        } else {
                            alert("Room is unavailable");
                            return false; // Prevent form submission
                        }
                    } else if (guestHouse === 'igh' && roomType === 'suite') {
                        if (suitesAvailable_IGH.length > 0) {
                            // Shift one element from singleRoomAvailable to singleRoomBooked
                            bookedRoom = suitesAvailable_IGH.shift();
                            suitesBooked_IGH.push(bookedRoom);
                        } else {
                            alert("Room is unavailable");
                            return false; // Prevent form submission
                        }
                    }
                    // Push data to Firebase
                    ref.push({
                        name: name,
                        email: email,
                        inst_email: inst_email,
                        phone: phone,
                        alt_phone: alt_phone,
                        category: category,
                        idProof: idProof,
                        idProofNumber: idProofNumber,
                        gender: gender,
                        permanentAddressLocation: permanentAddressLocation,
                        permanentAddressPin: permanentAddressPin,
                        permanentAddressState: permanentAddressState,
                        permanentAddressArea: permanentAddressArea,
                        guestHouse: guestHouse,
                        roomType: roomType,
                        roomNo: roomNo,
                        dateFrom: dateFrom,
                        dateTo: dateTo,
                        duration: duration,
                        dateTime: dateTime

                    }, function(error) {
                        if (error) {
                            alert("Error occurred while saving data: " + error.message);
                        } else {
                            alert("Booking Success");
                        }
                    });
                    return true; // Form is valid
                } else if (name === "" || email === "" || phone === "" || category === "" || idProof === "" ||
                    idProofNumber === "" || gender === "" || permanentAddressLocation === "" ||
                    permanentAddressPin === "" || permanentAddressState === "" || permanentAddressArea === "" ||
                    roomType === "" || enteredCaptcha === "") {
                            alert("Please fill in all mandatory fields.");
                            return false; // Prevent form submission
                } else if (enteredCaptcha !== displayedCaptcha) {
                    // Display the "Invalid Captcha" alert
                    var alertTimeout = setTimeout(function() {
                        alert("Invalid Captcha");
                    }, 500);
                    return false; // Prevent form submission
                }
            }
        </script>
    </body>
</html>